dnl Process this file with autoconf to produce a configure script.

AC_REVISION($Revision: 1.30 $)

AC_INIT()

MAJOR_VERSION=0
MINOR_VERSION=6
MICRO_VERSION=00
VERSION=$MAJOR_VERSION.$MINOR_VERSION.$MICRO_VERSION
RELEASE=$MAJOR_VERSION.$MINOR_VERSION
AC_DEFINE_UNQUOTED(MICRO_VERSION, "$MICRO_VERSION")
AC_DEFINE_UNQUOTED(SYSTEM, UNIX)
AC_SUBST(VERSION)
AC_SUBST(RELEASE)

LIBVERSION=0:1:0
LIBRELEASE=0:1:0
AC_SUBST(LIBVERSION)
AC_SUBST(LIBRELEASE)

SUBDIRS="Common"

GTKMM_NEEDED_MAYOR=1
GTKMM_NEEDED_MINOR=2
GTKMM_NEEDED_MICRO=7
GTKMM_MINVERSION=$GTKMM_NEEDED_MAYOR.$GTKMM_NEEDED_MINOR.$GTKMM_NEEDED_MICRO

dnl AC_CANONICAL_SYSTEM

AM_INIT_AUTOMAKE(General, $RELEASE)
AM_CONFIG_HEADER(gzo-cfg.h)

AC_LANG_C
AC_LANG_CPLUSPLUS

AC_C_BIGENDIAN

ALL_LINGUAS="de en es"

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CXX
AC_PROG_RANLIB
AM_PROG_LIBTOOL
AC_PROG_INSTALL
AC_PROG_MAKE_SET

AM_GNU_GETTEXT

dnl Checks for libraries.
AC_CHECK_LIB(stdc++, main)
AC_CHECK_LIB(gmp, main)

dnl Checks for header files.
dnl AC_CHECK_HEADERS(assert.h errno.h fstream.h iomanip.h iostream.h netinet/in.h)
dnl AC_CHECK_HEADERS(netdb.h stddef.h stdexcept stdio.h streambuf.h streamb.h)
dnl AC_CHECK_HEADERS(string sys/socket.h sys/stat.h sys/types.h syslog.h time.h)
dnl AC_CHECK_HEADERS(vector)

AC_HEADER_DIRENT

AC_MSG_CHECKING(Checking for header regex.h)
AC_CACHE_VAL(ac_cv_header_regex_h, ac_cv_header_regex_h=$ac_cv_header_regex_h)
if test -z $ac_cv_header_regex_h; then
AC_TRY_COMPILE(
   [ #include <sys/types.h>
     #include <regex.h>],
   [],
   [ ac_cv_header_regex_h=yes
     AC_DEFINE(HAVE_REGEX_H)],
   [ ac_cv_header_regex_h=no])
fi
AC_MSG_RESULT([$ac_cv_header_regex_h])
if test "$ac_cv_header_regex_h" != "yes"; then
   AC_CHECK_HEADERS(regexp.h)
fi

AC_MSG_CHECKING(Checking for header CORBA.h)
AC_CACHE_VAL(ac_cv_header_CORBA_h, ac_cv_header_CORBA_h=$ac_cv_header_CORBA_h)
if test -z $ac_cv_header_CORBA_h; then
AC_TRY_COMPILE([#include <CORBA.h>], [],
   [ ac_cv_header_CORBA_h=yes],
   [ ac_cv_header_CORBA_h=no])
fi
AC_MSG_RESULT([$ac_cv_header_CORBA_h])
if test "$ac_cv_header_CORBA_h" == "yes"; then
   SUBDIRS="$SUBDIRS CORBA"
else
   AC_WARN(CORBA is not installed; subdir CORBA will not be made)
fi

AC_MSG_CHECKING(Checking for Gtk-- - version)
ver=`gtkmm-config --version`
mayor=${ver%%.*}
minor=${ver#*.}
minor=${minor%.*}
micro=${ver##*.}
AC_MSG_RESULT($ver)
if test $mayor -lt $GTKMM_NEEDED_MAYOR -o $mayor -eq $GTKMM_NEEDED_MAYOR \
     -a $minor -lt $GTKMM_NEEDED_MINOR -o $minor -eq $GTKMM_NEEDED_MINOR \
     -a $micro -lt $GTKMM_NEEDED_MICRO; then
   AC_WARN(An old version of GTK-- ($mayor.$minor.$micro) was found.\n \
           You need at least version $GTKMM_MINVERSION.\n Subdir X-windows \
           will not be made)
else
   SUBDIRS="$SUBDIRS X-windows"
fi

AC_SUBST(SUBDIRS)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_HEADER_STAT
AC_STRUCT_TM

dnl Checks for library functions.
AC_FUNC_FNMATCH
AC_FUNC_CLOSEDIR_VOID

AC_CHECK_FUNCS(strfmon)

AC_OUTPUT([Makefile Common/Makefile Common/Tests/Makefile X-windows/Makefile \
           X-windows/Icons/Makefile CORBA/Makefile intl/Makefile po/Makefile.in])
